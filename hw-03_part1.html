<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kristi Manasil">

<title>hw-03_part1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw-03_part1_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw-03_part1_files/libs/quarto-html/quarto.js"></script>
<script src="hw-03_part1_files/libs/quarto-html/popper.min.js"></script>
<script src="hw-03_part1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw-03_part1_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw-03_part1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw-03_part1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw-03_part1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw-03_part1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw-03_part1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">hw-03_part1</h1>
<p class="subtitle lead">Classification: Basic Concepts and Techniques</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kristi Manasil </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="classification-basic-concepts-and-techniques" class="level1">
<h1><strong>Classification: Basic Concepts and Techniques</strong></h1>
<section id="install-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-packages"><strong>Install packages</strong></h2>
<p>Install the packages used in this chapter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pacman))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pacman</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, rpart, rpart.plot, caret, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  lattice, FSelector, sampling, pROC, mlbench)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h2>
<p>Classification is a machine learning task with the goal to learn a predictive function of the form</p>
<p>y=f(x),</p>
<p>where x is called the attribute set and y the class label. The attribute set consists of feature which describe an object. These features can be measured using any scale (i.e., nominal, interval, …). The class label is a nominal attribute. It it is a binary attribute, then the problem is called a binary classification problem.</p>
<p>Classification learns the classification model from training data where both the features and the correct class label are available. This is why it is called a <a href="https://en.wikipedia.org/wiki/Supervised_learning">supervised learning problem</a>.</p>
<p>A related supervised learning problem is <a href="https://en.wikipedia.org/wiki/Linear_regression">regression</a>, where y is a number instead of a label. Linear regression is a very popular supervised learning model, however, we will not talk about it here since it is taught in almost any introductory statistics course.</p>
<p>This chapter will introduce decision trees, model evaluation and comparison, feature selection, and then explore methods to handle the class imbalance problem.</p>
<p>You can read the free sample chapter from the textbook [@Tan2005]: <a href="https://www-users.cs.umn.edu/~kumar001/dmbook/ch3_classification.pdf">Chapter 3. Classification: Basic Concepts and Techniques</a></p>
</section>
<section id="the-bird-feederwatch-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-bird-feederwatch-dataset"><strong>The Bird FeederWatch Dataset</strong></h2>
<p>To demonstrate classification, I will use the two bird dataset which I will merge into a single frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in first data frame</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>bird1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PFW_2021_public.csv"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bird1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     loc_id latitude  longitude subnational1_code          entry_technique
1   L981010 52.12976 -122.13547             CA-BC POSTCODE LAT/LONG LOOKUP
2  L3161698 43.83221 -123.09240             US-OR      /GOOGLE_MAP/ZOOM:18
3 L13210778 39.72147  -75.93366             US-MD      /GOOGLE_MAP/ZOOM:15
4 L13258348 42.21787  -83.67230             US-MI      /GOOGLE_MAP/ZOOM:15
5   L149639 32.74992  -79.94158             US-SC          PointMaker1.0_2
6 L10140349 46.05301  -73.07027             CA-QC      /GOOGLE_MAP/ZOOM:18
     sub_id        obs_id Month Day Year PROJ_PERIOD_ID species_code how_many
1 S83206450 OBS1092604618     3   4 2021       PFW_2021       amegfi       20
2 S78031190 OBS1036509564    12  19 2020       PFW_2021       moudov       11
3 S81318993 OBS1073386105     2  13 2021       PFW_2021       tuftit        2
4 S79251313 OBS1051702542     1  13 2021       PFW_2021       houspa        2
5 S79183993 OBS1050809672     1  11 2021       PFW_2021       balori       10
6 S83449147 OBS1095479883     3  13 2021       PFW_2021       norcar        2
  valid reviewed day1_am day1_pm day2_am day2_pm effort_hrs_atleast
1     1        0       1       0       1       0              1.001
2     1        0       1       1       1       1              1.001
3     1        0       1       1       1       1              8.001
4     1        0       1       1       1       1              4.001
5     1        0       1       1       1       1              1.001
6     1        0       1       1       1       1              1.001
  snow_dep_atleast Data_Entry_Method
1            5.000     PFW Web 4.1.4
2            0.000     PFW Web 4.1.4
3            5.000     PFW Web 4.1.4
4            0.000     PFW Web 4.1.4
5            0.000     PFW Web 4.1.4
6           15.001     PFW Web 4.1.4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename PROJ_PERIOD_ID to lower case to match second df</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bird1 <span class="ot">&lt;-</span> bird1 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">proj_period_id =</span> PROJ_PERIOD_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in second data frame</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bird2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PFW_count_site_data_public_2021.csv"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bird2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   loc_id proj_period_id yard_type_pavement yard_type_garden yard_type_landsca
1 L100016       PFW_2002                  0                0                 1
2 L100016       PFW_2003                  0                0                 1
3 L100016       PFW_2004                  0                0                 1
4 L100016       PFW_2005                  0                0                 1
5 L100016       PFW_2006                  0                0                 1
6 L100016       PFW_2007                  0                0                 1
  yard_type_woods yard_type_desert hab_dcid_woods hab_evgr_woods
1               0                0              1             NA
2               0                0              1             NA
3               0                0              1             NA
4               0                0              1             NA
5               0                0              1              0
6               0                0              1              0
  hab_mixed_woods hab_orchard hab_park hab_water_fresh hab_water_salt
1               1          NA       NA               1             NA
2               1          NA       NA               1             NA
3               1          NA       NA               1             NA
4               1          NA       NA               1             NA
5               1           0        0               1              0
6               1           0        0               1              0
  hab_residential hab_industrial hab_agricultural hab_desert_scrub
1               1             NA                1               NA
2               1             NA                1               NA
3               1             NA                1               NA
4               1             NA                1               NA
5               1              0                1                0
6               1              0                1                0
  hab_young_woods hab_swamp hab_marsh evgr_trees_atleast evgr_shrbs_atleast
1              NA        NA         1                 11                  4
2              NA        NA         1                 11                  4
3              NA        NA         1                 11                  4
4              NA        NA         1                 11                  4
5               0         0         1                 11                  1
6               0         0         1                 11                  1
  dcid_trees_atleast dcid_shrbs_atleast fru_trees_atleast cacti_atleast
1                 11                  4                 4             0
2                 11                  4                 4             0
3                 11                  4                 4             0
4                 11                  4                 4             0
5                  1                  4                 1             0
6                  1                  4                 1             0
  brsh_piles_atleast water_srcs_atleast bird_baths_atleast nearby_feeders
1                  0                  1                  0              0
2                  0                  1                  0              1
3                  0                  1                  0              1
4                  0                  1                  0              1
5                  0                  1                  0              0
6                  0                  1                  0              0
  squirrels cats dogs humans housing_density fed_yr_round fed_in_jan fed_in_feb
1         0    0    0      0               2            0          1          1
2         0    1    0      0               2            0          1          1
3         0    1    0      0               2            0          1          1
4         0    1    0      0               2            0          1          1
5         0    1    0      0               2           NA          1          1
6         0    1    0      1               2           NA          1          1
  fed_in_mar fed_in_apr fed_in_may fed_in_jun fed_in_jul fed_in_aug fed_in_sep
1          1          1          0          0          0          0          0
2          1          1          0          0          0          0          0
3          1          1          0          0          0          0          0
4          1          1          0          0          0          0          0
5          1          1          0          0          0          0          0
6          1          0          0          0          0          0          0
  fed_in_oct fed_in_nov fed_in_dec numfeeders_suet numfeeders_ground
1          0          1          1               1                NA
2          0          1          1               1                 0
3          0          1          1               1                 0
4          0          1          1               1                 0
5          0          1          1               1                NA
6          0          1          1               1                NA
  numfeeders_hanging numfeeders_platfrm numfeeders_humming numfeeders_water
1                  1                  1                 NA                1
2                  1                  1                  0                1
3                  1                  1                  0                1
4                  3                  0                  0                1
5                 NA                 NA                 NA               NA
6                 NA                 NA                 NA               NA
  numfeeders_thistle numfeeders_fruit numfeeders_hopper numfeeders_tube
1                 NA               NA                NA              NA
2                  0                0                NA              NA
3                  0                0                NA              NA
4                  0                0                NA              NA
5                 NA               NA                 1               1
6                 NA               NA                 1               1
  numfeeders_other population_atleast count_area_size_sq_m_atleast
1               NA                  1                         1.01
2               NA                  1                         1.01
3               NA                  1                         1.01
4               NA                  1                         1.01
5               NA                  1                         1.01
6               NA                  1                         1.01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only the PFW_2021 obserevations from bird2.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>bird2 <span class="ot">&lt;-</span> bird2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(proj_period_id <span class="sc">==</span> <span class="st">"PFW_2021"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bird2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     loc_id proj_period_id yard_type_pavement yard_type_garden
1   L100032       PFW_2021                  0                0
2   L100057       PFW_2021                  0                0
3 L10007061       PFW_2021                  0                0
4 L10011987       PFW_2021                  0                0
5   L100209       PFW_2021                  0                0
6 L10022496       PFW_2021                  0                0
  yard_type_landsca yard_type_woods yard_type_desert hab_dcid_woods
1                 1               1                0              1
2                 1               0                0              0
3                 1               1                0              1
4                 1               1                0              1
5                 1               1                0              1
6                 0               0                0              1
  hab_evgr_woods hab_mixed_woods hab_orchard hab_park hab_water_fresh
1              0               1           0        0               1
2              0               1           0        0               0
3              0               0           0        0               1
4              0               1           0        1               1
5              0               1           0        0               1
6              0               1           1        0               1
  hab_water_salt hab_residential hab_industrial hab_agricultural
1              0               1              1                0
2              0               1              0                0
3              0               1              0                1
4              0               1              0                0
5              0               1              1                0
6              0               1              0                1
  hab_desert_scrub hab_young_woods hab_swamp hab_marsh evgr_trees_atleast
1                0               0         0         0                 11
2                0               0         0         0                  4
3                0               0         0         0                 11
4                0               1         0         1                 11
5                0               0         0         0                  0
6                0               0         0         0                  4
  evgr_shrbs_atleast dcid_trees_atleast dcid_shrbs_atleast fru_trees_atleast
1                  1                  1                 11                11
2                  1                  4                  4                 0
3                  0                  1                  1                 0
4                 11                 11                 11                 4
5                  1                  4                  0                 1
6                  0                  1                  4                 0
  cacti_atleast brsh_piles_atleast water_srcs_atleast bird_baths_atleast
1             0                  1                  0                  1
2             0                  1                  0                  1
3             0                  0                  0                  1
4             0                  1                  0                  1
5             0                  1                  1                  1
6             0                  0                  0                  1
  nearby_feeders squirrels cats dogs humans housing_density fed_yr_round
1              1         1    0    0      1               2            1
2              0         1    0    0      0               3            1
3              0         1    0    0      1               2            1
4              0         1    1    0      1               2            1
5              1         1    0    1      1               3            1
6              1         1    0    0      1               1            1
  fed_in_jan fed_in_feb fed_in_mar fed_in_apr fed_in_may fed_in_jun fed_in_jul
1          1          1          1          1          1          1          1
2          1          1          1          1          1          1          1
3          1          1          1          1          1          1          1
4          1          1          1          1          1          1          1
5          1          1          1          1          1          1          1
6          1          1          1          1          1          1          1
  fed_in_aug fed_in_sep fed_in_oct fed_in_nov fed_in_dec numfeeders_suet
1          1          1          1          1          1               1
2          1          1          1          1          1               1
3          1          1          1          1          1               1
4          1          1          1          1          1               1
5          1          1          1          1          1               1
6          1          1          1          1          1               1
  numfeeders_ground numfeeders_hanging numfeeders_platfrm numfeeders_humming
1                 1                 NA                  2                  0
2                 3                 NA                  2                  1
3                 0                 NA                  1                  0
4                 1                 NA                  4                  0
5                 1                 NA                  1                  0
6                 0                 NA                  0                  1
  numfeeders_water numfeeders_thistle numfeeders_fruit numfeeders_hopper
1               NA                 NA                0                 1
2               NA                 NA                0                 4
3               NA                 NA                0                 0
4               NA                 NA                0                 0
5               NA                 NA                0                 0
6               NA                 NA                0                 2
  numfeeders_tube numfeeders_other population_atleast
1               4                2               5001
2               2                0               5001
3               2                0               5001
4               3                0               5001
5               0                1                  1
6               2                0                  1
  count_area_size_sq_m_atleast
1                       100.01
2                       375.01
3                         1.01
4                       375.01
5                         1.01
6                         1.01</code></pre>
</div>
</div>
<p>I am going to merge these into one data frame by using the loc_id and proj_period_id columns. And remove na values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge into 1 frame.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(bird1, bird2, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"loc_id"</span>, <span class="st">"proj_period_id"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>bird_df <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 77,520
Columns: 82
$ loc_id                       &lt;chr&gt; "L100032", "L100032", "L100032", "L100032…
$ proj_period_id               &lt;chr&gt; "PFW_2021", "PFW_2021", "PFW_2021", "PFW_…
$ latitude                     &lt;dbl&gt; 45.13236, 45.13236, 45.13236, 45.13236, 4…
$ longitude                    &lt;dbl&gt; -93.13033, -93.13033, -93.13033, -93.1303…
$ subnational1_code            &lt;chr&gt; "US-MN", "US-MN", "US-MN", "US-MN", "US-M…
$ entry_technique              &lt;chr&gt; "PointMaker1.0_2", "PointMaker1.0_2", "Po…
$ sub_id                       &lt;chr&gt; "S76349308", "S76572687", "S84070089", "S…
$ obs_id                       &lt;chr&gt; "OBS1013052720", "OBS1016108597", "OBS110…
$ Month                        &lt;int&gt; 11, 11, 3, 4, 1, 4, 1, 2, 4, 12, 4, 11, 4…
$ Day                          &lt;int&gt; 14, 21, 20, 24, 2, 24, 2, 13, 25, 13, 11,…
$ Year                         &lt;int&gt; 2020, 2020, 2021, 2021, 2021, 2021, 2021,…
$ species_code                 &lt;chr&gt; "whtspa", "daejun", "daejun", "blujay", "…
$ how_many                     &lt;int&gt; 5, 6, 1, 1, 2, 1, 2, 1, 1, 1, 1, 3, 1, 1,…
$ valid                        &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ reviewed                     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ day1_am                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ day1_pm                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ day2_am                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ day2_pm                      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ effort_hrs_atleast           &lt;dbl&gt; 1.001, 1.001, 1.001, 1.001, 1.001, 1.001,…
$ snow_dep_atleast             &lt;dbl&gt; 0.001, 0.000, 0.000, 0.000, 5.000, 0.000,…
$ Data_Entry_Method            &lt;chr&gt; "PFW Web 4.0.4", "PFW Web 4.1.4", "PFW We…
$ yard_type_pavement           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ yard_type_garden             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ yard_type_landsca            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ yard_type_woods              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ yard_type_desert             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_dcid_woods               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ hab_evgr_woods               &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_mixed_woods              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ hab_orchard                  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_park                     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_water_fresh              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ hab_water_salt               &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_residential              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ hab_industrial               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ hab_agricultural             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_desert_scrub             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_young_woods              &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_swamp                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ hab_marsh                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ evgr_trees_atleast           &lt;int&gt; 11, 11, 11, 11, 11, 11, 11, 11, 4, 4, 4, …
$ evgr_shrbs_atleast           &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ dcid_trees_atleast           &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4,…
$ dcid_shrbs_atleast           &lt;int&gt; 11, 11, 11, 11, 11, 11, 11, 11, 4, 4, 4, …
$ fru_trees_atleast            &lt;int&gt; 11, 11, 11, 11, 11, 11, 11, 11, 0, 0, 0, …
$ cacti_atleast                &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ brsh_piles_atleast           &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ water_srcs_atleast           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ bird_baths_atleast           &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ nearby_feeders               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ squirrels                    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ cats                         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ dogs                         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ humans                       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,…
$ housing_density              &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3,…
$ fed_yr_round                 &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_jan                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_feb                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_mar                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_apr                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_may                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_jun                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_jul                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_aug                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_sep                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_oct                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_nov                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ fed_in_dec                   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ numfeeders_suet              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ numfeeders_ground            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3,…
$ numfeeders_hanging           &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ numfeeders_platfrm           &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
$ numfeeders_humming           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1,…
$ numfeeders_water             &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ numfeeders_thistle           &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ numfeeders_fruit             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ numfeeders_hopper            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4,…
$ numfeeders_tube              &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2,…
$ numfeeders_other             &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0,…
$ population_atleast           &lt;int&gt; 5001, 5001, 5001, 5001, 5001, 5001, 5001,…
$ count_area_size_sq_m_atleast &lt;dbl&gt; 100.01, 100.01, 100.01, 100.01, 100.01, 1…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop columns that appear to be all na</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> <span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(<span class="st">"numfeeders_hanging"</span>, <span class="st">"numfeeders_water"</span>, <span class="st">"numfeeders_thistle"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove other rows with na values</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display as tibble</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 61,113 × 79
   loc_id  proj_period_id latitude longitude subnational1_code entry_technique
   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;          
 1 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 2 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 3 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 4 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 5 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 6 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 7 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 8 L100032 PFW_2021           45.1     -93.1 US-MN             PointMaker1.0_2
 9 L100057 PFW_2021           41.9     -71.0 US-MA             PointMaker1.0_2
10 L100057 PFW_2021           41.9     -71.0 US-MA             PointMaker1.0_2
# ℹ 61,103 more rows
# ℹ 73 more variables: sub_id &lt;chr&gt;, obs_id &lt;chr&gt;, Month &lt;int&gt;, Day &lt;int&gt;,
#   Year &lt;int&gt;, species_code &lt;chr&gt;, how_many &lt;int&gt;, valid &lt;int&gt;,
#   reviewed &lt;int&gt;, day1_am &lt;int&gt;, day1_pm &lt;int&gt;, day2_am &lt;int&gt;, day2_pm &lt;int&gt;,
#   effort_hrs_atleast &lt;dbl&gt;, snow_dep_atleast &lt;dbl&gt;, Data_Entry_Method &lt;chr&gt;,
#   yard_type_pavement &lt;int&gt;, yard_type_garden &lt;int&gt;, yard_type_landsca &lt;int&gt;,
#   yard_type_woods &lt;int&gt;, yard_type_desert &lt;int&gt;, hab_dcid_woods &lt;int&gt;, …</code></pre>
</div>
</div>
<p>This still has 79 columns, so I am going to cut out a few that I am not going to use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make the obs_id the index</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(bird_df) <span class="ot">&lt;-</span> bird_df<span class="sc">$</span>obs_id</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove columns</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> <span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(loc_id, proj_period_id, Data_Entry_Method, latitude, longitude, subnational1_code, entry_technique, sub_id, Month, Day, Year, how_many, valid, reviewed, day1_am, day1_pm, day2_am, day2_pm, effort_hrs_atleast, snow_dep_atleast, population_atleast, count_area_size_sq_m_atleast))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the obs_id column</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> <span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(obs_id))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              species_code yard_type_pavement yard_type_garden
OBS1013052720       whtspa                  0                0
OBS1016108597       daejun                  0                0
OBS1103063749       daejun                  0                0
OBS1155529086       blujay                  0                0
OBS1043705011       bkcchi                  0                0
OBS1155529080       whbnut                  0                0
              yard_type_landsca yard_type_woods yard_type_desert hab_dcid_woods
OBS1013052720                 1               1                0              1
OBS1016108597                 1               1                0              1
OBS1103063749                 1               1                0              1
OBS1155529086                 1               1                0              1
OBS1043705011                 1               1                0              1
OBS1155529080                 1               1                0              1
              hab_evgr_woods hab_mixed_woods hab_orchard hab_park
OBS1013052720              0               1           0        0
OBS1016108597              0               1           0        0
OBS1103063749              0               1           0        0
OBS1155529086              0               1           0        0
OBS1043705011              0               1           0        0
OBS1155529080              0               1           0        0
              hab_water_fresh hab_water_salt hab_residential hab_industrial
OBS1013052720               1              0               1              1
OBS1016108597               1              0               1              1
OBS1103063749               1              0               1              1
OBS1155529086               1              0               1              1
OBS1043705011               1              0               1              1
OBS1155529080               1              0               1              1
              hab_agricultural hab_desert_scrub hab_young_woods hab_swamp
OBS1013052720                0                0               0         0
OBS1016108597                0                0               0         0
OBS1103063749                0                0               0         0
OBS1155529086                0                0               0         0
OBS1043705011                0                0               0         0
OBS1155529080                0                0               0         0
              hab_marsh evgr_trees_atleast evgr_shrbs_atleast
OBS1013052720         0                 11                  1
OBS1016108597         0                 11                  1
OBS1103063749         0                 11                  1
OBS1155529086         0                 11                  1
OBS1043705011         0                 11                  1
OBS1155529080         0                 11                  1
              dcid_trees_atleast dcid_shrbs_atleast fru_trees_atleast
OBS1013052720                  1                 11                11
OBS1016108597                  1                 11                11
OBS1103063749                  1                 11                11
OBS1155529086                  1                 11                11
OBS1043705011                  1                 11                11
OBS1155529080                  1                 11                11
              cacti_atleast brsh_piles_atleast water_srcs_atleast
OBS1013052720             0                  1                  0
OBS1016108597             0                  1                  0
OBS1103063749             0                  1                  0
OBS1155529086             0                  1                  0
OBS1043705011             0                  1                  0
OBS1155529080             0                  1                  0
              bird_baths_atleast nearby_feeders squirrels cats dogs humans
OBS1013052720                  1              1         1    0    0      1
OBS1016108597                  1              1         1    0    0      1
OBS1103063749                  1              1         1    0    0      1
OBS1155529086                  1              1         1    0    0      1
OBS1043705011                  1              1         1    0    0      1
OBS1155529080                  1              1         1    0    0      1
              housing_density fed_yr_round fed_in_jan fed_in_feb fed_in_mar
OBS1013052720               2            1          1          1          1
OBS1016108597               2            1          1          1          1
OBS1103063749               2            1          1          1          1
OBS1155529086               2            1          1          1          1
OBS1043705011               2            1          1          1          1
OBS1155529080               2            1          1          1          1
              fed_in_apr fed_in_may fed_in_jun fed_in_jul fed_in_aug fed_in_sep
OBS1013052720          1          1          1          1          1          1
OBS1016108597          1          1          1          1          1          1
OBS1103063749          1          1          1          1          1          1
OBS1155529086          1          1          1          1          1          1
OBS1043705011          1          1          1          1          1          1
OBS1155529080          1          1          1          1          1          1
              fed_in_oct fed_in_nov fed_in_dec numfeeders_suet
OBS1013052720          1          1          1               1
OBS1016108597          1          1          1               1
OBS1103063749          1          1          1               1
OBS1155529086          1          1          1               1
OBS1043705011          1          1          1               1
OBS1155529080          1          1          1               1
              numfeeders_ground numfeeders_platfrm numfeeders_humming
OBS1013052720                 1                  2                  0
OBS1016108597                 1                  2                  0
OBS1103063749                 1                  2                  0
OBS1155529086                 1                  2                  0
OBS1043705011                 1                  2                  0
OBS1155529080                 1                  2                  0
              numfeeders_fruit numfeeders_hopper numfeeders_tube
OBS1013052720                0                 1               4
OBS1016108597                0                 1               4
OBS1103063749                0                 1               4
OBS1155529086                0                 1               4
OBS1043705011                0                 1               4
OBS1155529080                0                 1               4
              numfeeders_other
OBS1013052720                2
OBS1016108597                2
OBS1103063749                2
OBS1155529086                2
OBS1043705011                2
OBS1155529080                2</code></pre>
</div>
</div>
<p>This is still a lot of variable to work with so I am going to remove the atleast columns and the fed_in columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove some more columns</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bird_df<span class="ot">&lt;-</span><span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">21</span><span class="sc">:</span><span class="dv">29</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and remove some more</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>bird_df<span class="ot">&lt;-</span><span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">28</span><span class="sc">:</span><span class="dv">47</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 61113 observations is a little much so I am going to try using just the first 1000 rows</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> bird_df[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Okay to make this more usable, lets just consider 4 species</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> bird_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species_code <span class="sc">==</span> <span class="st">"daejun"</span><span class="sc">|</span>species_code <span class="sc">==</span> <span class="st">"amegfi"</span><span class="sc">|</span>species_code <span class="sc">==</span> <span class="st">"bkcchi"</span><span class="sc">|</span> species_code <span class="sc">==</span> <span class="st">"blujay"</span><span class="sc">|</span>species_code <span class="sc">==</span> <span class="st">"tuftit"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lets also rename the species code to just species</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> bird_df <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">species =</span> species_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make 1 and 0 logical values to mimic example problem</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> bird_df <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">'yard_type_pavement'</span>,<span class="st">'yard_type_garden'</span>, <span class="st">'yard_type_landsca'</span>, <span class="st">'yard_type_woods'</span>, <span class="st">"yard_type_desert"</span>, <span class="st">'hab_dcid_woods'</span>,<span class="st">'hab_evgr_woods'</span>, <span class="st">'hab_mixed_woods'</span>, <span class="st">'hab_orchard'</span>, <span class="st">'hab_park'</span>,<span class="st">'hab_water_fresh'</span>,<span class="st">'hab_water_salt'</span>,  <span class="st">'hab_residential'</span>, <span class="st">'hab_industrial'</span>, <span class="st">'hab_agricultural'</span>, <span class="st">'hab_desert_scrub'</span>, <span class="st">'hab_young_woods'</span>, <span class="st">'hab_swamp'</span>, <span class="st">'hab_marsh'</span>, <span class="st">'nearby_feeders'</span>, <span class="st">"squirrels"</span>, <span class="st">'cats'</span>, <span class="st">'dogs'</span>, <span class="st">'humans'</span>, <span class="st">'fed_yr_round'</span> ),as.logical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bird_df <span class="ot">&lt;-</span> bird_df <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), factor, <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(where(is.logical), factor, levels = c(TRUE, FALSE))`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              species yard_type_pavement yard_type_garden yard_type_landsca
OBS1016108597  daejun              FALSE            FALSE              TRUE
OBS1103063749  daejun              FALSE            FALSE              TRUE
OBS1155529086  blujay              FALSE            FALSE              TRUE
OBS1043705011  bkcchi              FALSE            FALSE              TRUE
OBS1043705010  blujay              FALSE            FALSE              TRUE
OBS1074366638  blujay              FALSE            FALSE              TRUE
              yard_type_woods yard_type_desert hab_dcid_woods hab_evgr_woods
OBS1016108597            TRUE            FALSE           TRUE          FALSE
OBS1103063749            TRUE            FALSE           TRUE          FALSE
OBS1155529086            TRUE            FALSE           TRUE          FALSE
OBS1043705011            TRUE            FALSE           TRUE          FALSE
OBS1043705010            TRUE            FALSE           TRUE          FALSE
OBS1074366638            TRUE            FALSE           TRUE          FALSE
              hab_mixed_woods hab_orchard hab_park hab_water_fresh
OBS1016108597            TRUE       FALSE    FALSE            TRUE
OBS1103063749            TRUE       FALSE    FALSE            TRUE
OBS1155529086            TRUE       FALSE    FALSE            TRUE
OBS1043705011            TRUE       FALSE    FALSE            TRUE
OBS1043705010            TRUE       FALSE    FALSE            TRUE
OBS1074366638            TRUE       FALSE    FALSE            TRUE
              hab_water_salt hab_residential hab_industrial hab_agricultural
OBS1016108597          FALSE            TRUE           TRUE            FALSE
OBS1103063749          FALSE            TRUE           TRUE            FALSE
OBS1155529086          FALSE            TRUE           TRUE            FALSE
OBS1043705011          FALSE            TRUE           TRUE            FALSE
OBS1043705010          FALSE            TRUE           TRUE            FALSE
OBS1074366638          FALSE            TRUE           TRUE            FALSE
              hab_desert_scrub hab_young_woods hab_swamp hab_marsh
OBS1016108597            FALSE           FALSE     FALSE     FALSE
OBS1103063749            FALSE           FALSE     FALSE     FALSE
OBS1155529086            FALSE           FALSE     FALSE     FALSE
OBS1043705011            FALSE           FALSE     FALSE     FALSE
OBS1043705010            FALSE           FALSE     FALSE     FALSE
OBS1074366638            FALSE           FALSE     FALSE     FALSE
              nearby_feeders squirrels  cats  dogs humans housing_density
OBS1016108597           TRUE      TRUE FALSE FALSE   TRUE               2
OBS1103063749           TRUE      TRUE FALSE FALSE   TRUE               2
OBS1155529086           TRUE      TRUE FALSE FALSE   TRUE               2
OBS1043705011           TRUE      TRUE FALSE FALSE   TRUE               2
OBS1043705010           TRUE      TRUE FALSE FALSE   TRUE               2
OBS1074366638           TRUE      TRUE FALSE FALSE   TRUE               2
              fed_yr_round
OBS1016108597         TRUE
OBS1103063749         TRUE
OBS1155529086         TRUE
OBS1043705011         TRUE
OBS1043705010         TRUE
OBS1074366638         TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species   yard_type_pavement yard_type_garden yard_type_landsca
 amegfi:57   TRUE :  0          TRUE :  4        TRUE :222        
 bkcchi:53   FALSE:250          FALSE:246        FALSE: 28        
 blujay:51                                                        
 daejun:60                                                        
 tuftit:29                                                        
                                                                  
 yard_type_woods yard_type_desert hab_dcid_woods hab_evgr_woods hab_mixed_woods
 TRUE :192       TRUE :  0        TRUE :123      TRUE : 34      TRUE :193      
 FALSE: 58       FALSE:250        FALSE:127      FALSE:216      FALSE: 57      
                                                                               
                                                                               
                                                                               
                                                                               
 hab_orchard  hab_park   hab_water_fresh hab_water_salt hab_residential
 TRUE : 23   TRUE :115   TRUE :143       TRUE : 12      TRUE :231      
 FALSE:227   FALSE:135   FALSE:107       FALSE:238      FALSE: 19      
                                                                       
                                                                       
                                                                       
                                                                       
 hab_industrial hab_agricultural hab_desert_scrub hab_young_woods hab_swamp  
 TRUE : 71      TRUE : 83        TRUE :  3        TRUE : 91       TRUE : 44  
 FALSE:179      FALSE:167        FALSE:247        FALSE:159       FALSE:206  
                                                                             
                                                                             
                                                                             
                                                                             
 hab_marsh   nearby_feeders squirrels      cats        dogs       humans   
 TRUE : 52   TRUE :123      TRUE :238   TRUE : 92   TRUE :132   TRUE :222  
 FALSE:198   FALSE:127      FALSE: 12   FALSE:158   FALSE:118   FALSE: 28  
                                                                           
                                                                           
                                                                           
                                                                           
 housing_density fed_yr_round
 Min.   :1.000   TRUE :239   
 1st Qu.:1.000   FALSE: 11   
 Median :2.000               
 Mean   :2.176               
 3rd Qu.:3.000               
 Max.   :4.000               </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove a few more</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>bird_df<span class="ot">&lt;-</span><span class="fu">select</span>(bird_df, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">22</span>, <span class="dv">27</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bird_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species   yard_type_landsca yard_type_woods hab_dcid_woods hab_mixed_woods
 amegfi:57   TRUE :222         TRUE :192       TRUE :123      TRUE :193      
 bkcchi:53   FALSE: 28         FALSE: 58       FALSE:127      FALSE: 57      
 blujay:51                                                                   
 daejun:60                                                                   
 tuftit:29                                                                   
                                                                             
  hab_park   hab_water_fresh hab_industrial hab_agricultural hab_young_woods
 TRUE :115   TRUE :143       TRUE : 71      TRUE : 83        TRUE : 91      
 FALSE:135   FALSE:107       FALSE:179      FALSE:167        FALSE:159      
                                                                            
                                                                            
                                                                            
                                                                            
 hab_swamp   hab_marsh   nearby_feeders    cats        dogs       humans   
 TRUE : 44   TRUE : 52   TRUE :123      TRUE : 92   TRUE :132   TRUE :222  
 FALSE:206   FALSE:198   FALSE:127      FALSE:158   FALSE:118   FALSE: 28  
                                                                           
                                                                           
                                                                           
                                                                           
 housing_density
 Min.   :1.000  
 1st Qu.:1.000  
 Median :2.000  
 Mean   :2.176  
 3rd Qu.:3.000  
 Max.   :4.000  </code></pre>
</div>
</div>
<p>Okay I think I have a dataset that will work!</p>
</section>
<section id="decision-trees" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees"><strong>Decision Trees</strong></h2>
<p>Recursive Partitioning (similar to CART) uses the Gini index to make splitting decisions and early stopping (pre-pruning).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="create-tree-with-default-settings-uses-pre-pruning" class="level3">
<h3 class="anchored" data-anchor-id="create-tree-with-default-settings-uses-pre-pruning"><strong>Create Tree With Default Settings (uses pre-pruning)</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tree_default <span class="ot">&lt;-</span> bird_df <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart</span>(species<span class="sc">~</span>.,<span class="at">data=</span>_)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>tree_default</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 250 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

  1) root 250 190 daejun (0.23 0.21 0.2 0.24 0.12)  
    2) hab_water_fresh=FALSE 107  70 daejun (0.21 0.26 0.14 0.35 0.047)  
      4) hab_marsh=TRUE 15   5 bkcchi (0.2 0.67 0 0.13 0) *
      5) hab_marsh=FALSE 92  57 daejun (0.21 0.2 0.16 0.38 0.054)  
       10) yard_type_woods=FALSE 35  25 amegfi (0.29 0.29 0.14 0.2 0.086)  
         20) hab_industrial=TRUE 14   7 bkcchi (0.14 0.5 0.14 0.14 0.071) *
         21) hab_industrial=FALSE 21  13 amegfi (0.38 0.14 0.14 0.24 0.095)  
           42) hab_park=TRUE 14   7 amegfi (0.5 0.071 0.21 0.14 0.071) *
           43) hab_park=FALSE 7   4 daejun (0.14 0.29 0 0.43 0.14) *
       11) yard_type_woods=TRUE 57  29 daejun (0.16 0.14 0.18 0.49 0.035)  
         22) humans=FALSE 11   6 blujay (0.18 0.18 0.45 0.091 0.091) *
         23) humans=TRUE 46  19 daejun (0.15 0.13 0.11 0.59 0.022) *
    3) hab_water_fresh=TRUE 143 107 blujay (0.24 0.17 0.25 0.16 0.17)  
      6) yard_type_woods=TRUE 126  92 blujay (0.25 0.18 0.27 0.12 0.18)  
       12) hab_dcid_woods=TRUE 82  57 blujay (0.29 0.15 0.3 0.085 0.17)  
         24) hab_mixed_woods=FALSE 9   4 amegfi (0.56 0 0.11 0 0.33) *
         25) hab_mixed_woods=TRUE 73  49 blujay (0.26 0.16 0.33 0.096 0.15)  
           50) dogs=TRUE 36  23 blujay (0.28 0.25 0.36 0.028 0.083)  
            100) hab_industrial=TRUE 15   8 amegfi (0.47 0.2 0.2 0 0.13) *
            101) hab_industrial=FALSE 21  11 blujay (0.14 0.29 0.48 0.048 0.048) *
           51) dogs=FALSE 37  26 blujay (0.24 0.081 0.3 0.16 0.22)  
            102) hab_agricultural=TRUE 14   7 amegfi (0.5 0 0.071 0.21 0.21) *
            103) hab_agricultural=FALSE 23  13 blujay (0.087 0.13 0.43 0.13 0.22) *
       13) hab_dcid_woods=FALSE 44  33 bkcchi (0.16 0.25 0.2 0.18 0.2)  
         26) hab_young_woods=TRUE 12   6 bkcchi (0.25 0.5 0.083 0.083 0.083) *
         27) hab_young_woods=FALSE 32  24 blujay (0.12 0.16 0.25 0.22 0.25) *
      7) yard_type_woods=FALSE 17   9 daejun (0.24 0.12 0.12 0.47 0.059) *</code></pre>
</div>
</div>
<p>This is not as easy to understand as the example but lets see how it looks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_default, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="create-a-full-tree" class="level3">
<h3 class="anchored" data-anchor-id="create-a-full-tree"><strong>Create a Full Tree</strong></h3>
<p>To create a full tree, we set the complexity parameter cp to 0 (split even if it does not improve the tree) and we set the minimum number of observations in a node needed to split to the smallest value of 2 (see: <code>?rpart.control</code>). <em>Note:</em> full trees overfit the training data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tree_full <span class="ot">&lt;-</span> <span class="fu">rpart</span>(species <span class="sc">~</span>.,<span class="at">data=</span>bird_df,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">2</span>, <span class="at">cp =</span> <span class="dv">0</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_full, <span class="at">extra =</span> <span class="dv">2</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">roundint=</span><span class="cn">FALSE</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">box.palette =</span> <span class="fu">list</span>(<span class="st">"Gy"</span>, <span class="st">"Gn"</span>, <span class="st">"Bu"</span>, <span class="st">"Bn"</span>,<span class="st">"Or"</span>, <span class="st">"Rd"</span>, <span class="st">"Pu"</span>)) <span class="co"># specify 4 colors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: labs do not fit even at cex 0.15, there may be some overplotting</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Clear as mud, Right?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tree_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 250 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

   1) root 250 190 daejun (0.23 0.21 0.2 0.24 0.12)  
     2) hab_water_fresh=FALSE 107  70 daejun (0.21 0.26 0.14 0.35 0.047)  
       4) hab_marsh=TRUE 15   5 bkcchi (0.2 0.67 0 0.13 0)  
         8) hab_swamp=FALSE 12   3 bkcchi (0.25 0.75 0 0 0)  
          16) housing_density&gt;=3.5 1   0 amegfi (1 0 0 0 0) *
          17) housing_density&lt; 3.5 11   2 bkcchi (0.18 0.82 0 0 0) *
         9) hab_swamp=TRUE 3   1 daejun (0 0.33 0 0.67 0) *
       5) hab_marsh=FALSE 92  57 daejun (0.21 0.2 0.16 0.38 0.054)  
        10) yard_type_woods=FALSE 35  25 amegfi (0.29 0.29 0.14 0.2 0.086)  
          20) housing_density&lt; 1.5 5   1 bkcchi (0 0.8 0.2 0 0) *
          21) housing_density&gt;=1.5 30  20 amegfi (0.33 0.2 0.13 0.23 0.1)  
            42) hab_park=TRUE 21  12 amegfi (0.43 0.14 0.19 0.14 0.095)  
              84) cats=FALSE 14   8 amegfi (0.43 0.14 0.29 0.071 0.071)  
               168) hab_agricultural=FALSE 10   5 amegfi (0.5 0.2 0.1 0.1 0.1) *
               169) hab_agricultural=TRUE 4   1 blujay (0.25 0 0.75 0 0) *
              85) cats=TRUE 7   4 amegfi (0.43 0.14 0 0.29 0.14)  
               170) hab_agricultural=TRUE 6   3 amegfi (0.5 0.17 0 0.17 0.17) *
               171) hab_agricultural=FALSE 1   0 daejun (0 0 0 1 0) *
            43) hab_park=FALSE 9   5 daejun (0.11 0.33 0 0.44 0.11)  
              86) hab_dcid_woods=TRUE 1   0 amegfi (1 0 0 0 0) *
              87) hab_dcid_woods=FALSE 8   4 daejun (0 0.38 0 0.5 0.12) *
        11) yard_type_woods=TRUE 57  29 daejun (0.16 0.14 0.18 0.49 0.035)  
          22) humans=FALSE 11   6 blujay (0.18 0.18 0.45 0.091 0.091)  
            44) nearby_feeders=TRUE 2   0 bkcchi (0 1 0 0 0) *
            45) nearby_feeders=FALSE 9   4 blujay (0.22 0 0.56 0.11 0.11)  
              90) dogs=TRUE 1   0 amegfi (1 0 0 0 0) *
              91) dogs=FALSE 8   3 blujay (0.12 0 0.62 0.12 0.12) *
          23) humans=TRUE 46  19 daejun (0.15 0.13 0.11 0.59 0.022)  
            46) housing_density&lt; 1.5 11   7 daejun (0.18 0.18 0.27 0.36 0)  
              92) hab_young_woods=FALSE 4   2 bkcchi (0.25 0.5 0.25 0 0) *
              93) hab_young_woods=TRUE 7   3 daejun (0.14 0 0.29 0.57 0) *
            47) housing_density&gt;=1.5 35  12 daejun (0.14 0.11 0.057 0.66 0.029)  
              94) hab_young_woods=TRUE 4   2 bkcchi (0 0.5 0 0.5 0)  
               188) housing_density&gt;=2.5 2   0 bkcchi (0 1 0 0 0) *
               189) housing_density&lt; 2.5 2   0 daejun (0 0 0 1 0) *
              95) hab_young_woods=FALSE 31  10 daejun (0.16 0.065 0.065 0.68 0.032)  
               190) hab_mixed_woods=FALSE 10   5 daejun (0.2 0 0.2 0.5 0.1)  
                 380) hab_park=TRUE 4   2 amegfi (0.5 0 0.25 0.25 0)  
                   760) hab_dcid_woods=FALSE 2   1 amegfi (0.5 0 0.5 0 0)  
                    1520) dogs=FALSE 1   0 amegfi (1 0 0 0 0) *
                    1521) dogs=TRUE 1   0 blujay (0 0 1 0 0) *
                   761) hab_dcid_woods=TRUE 2   1 amegfi (0.5 0 0 0.5 0) *
                 381) hab_park=FALSE 6   2 daejun (0 0 0.17 0.67 0.17)  
                   762) dogs=TRUE 1   0 blujay (0 0 1 0 0) *
                   763) dogs=FALSE 5   1 daejun (0 0 0 0.8 0.2) *
               191) hab_mixed_woods=TRUE 21   5 daejun (0.14 0.095 0 0.76 0)  
                 382) hab_industrial=TRUE 8   4 daejun (0.38 0.12 0 0.5 0)  
                   764) hab_park=FALSE 4   1 amegfi (0.75 0 0 0.25 0) *
                   765) hab_park=TRUE 4   1 daejun (0 0.25 0 0.75 0) *
                 383) hab_industrial=FALSE 13   1 daejun (0 0.077 0 0.92 0) *
     3) hab_water_fresh=TRUE 143 107 blujay (0.24 0.17 0.25 0.16 0.17)  
       6) yard_type_woods=TRUE 126  92 blujay (0.25 0.18 0.27 0.12 0.18)  
        12) hab_dcid_woods=TRUE 82  57 blujay (0.29 0.15 0.3 0.085 0.17)  
          24) hab_mixed_woods=FALSE 9   4 amegfi (0.56 0 0.11 0 0.33)  
            48) housing_density&lt; 1.5 7   2 amegfi (0.71 0 0.14 0 0.14) *
            49) housing_density&gt;=1.5 2   0 tuftit (0 0 0 0 1) *
          25) hab_mixed_woods=TRUE 73  49 blujay (0.26 0.16 0.33 0.096 0.15)  
            50) dogs=TRUE 36  23 blujay (0.28 0.25 0.36 0.028 0.083)  
             100) hab_industrial=TRUE 15   8 amegfi (0.47 0.2 0.2 0 0.13)  
               200) hab_park=TRUE 5   2 amegfi (0.6 0 0.4 0 0)  
                 400) hab_agricultural=FALSE 4   1 amegfi (0.75 0 0.25 0 0) *
                 401) hab_agricultural=TRUE 1   0 blujay (0 0 1 0 0) *
               201) hab_park=FALSE 10   6 amegfi (0.4 0.3 0.1 0 0.2) *
             101) hab_industrial=FALSE 21  11 blujay (0.14 0.29 0.48 0.048 0.048)  
               202) nearby_feeders=FALSE 17  10 blujay (0.18 0.35 0.41 0.059 0)  
                 404) housing_density&lt; 1.5 9   4 bkcchi (0.11 0.56 0.22 0.11 0) *
                 405) housing_density&gt;=1.5 8   3 blujay (0.25 0.12 0.62 0 0)  
                   810) housing_density&lt; 3 6   3 blujay (0.33 0.17 0.5 0 0)  
                    1620) hab_agricultural=FALSE 1   0 amegfi (1 0 0 0 0) *
                    1621) hab_agricultural=TRUE 5   2 blujay (0.2 0.2 0.6 0 0) *
                   811) housing_density&gt;=3 2   0 blujay (0 0 1 0 0) *
               203) nearby_feeders=TRUE 4   1 blujay (0 0 0.75 0 0.25) *
            51) dogs=FALSE 37  26 blujay (0.24 0.081 0.3 0.16 0.22)  
             102) hab_agricultural=TRUE 14   7 amegfi (0.5 0 0.071 0.21 0.21) *
             103) hab_agricultural=FALSE 23  13 blujay (0.087 0.13 0.43 0.13 0.22)  
               206) hab_young_woods=FALSE 7   3 blujay (0 0.14 0.57 0.29 0) *
               207) hab_young_woods=TRUE 16  10 blujay (0.12 0.12 0.38 0.062 0.31)  
                 414) hab_park=FALSE 10   7 tuftit (0.2 0.2 0.2 0.1 0.3)  
                   828) yard_type_landsca=TRUE 8   6 amegfi (0.25 0.12 0.25 0.12 0.25)  
                    1656) hab_marsh=FALSE 7   5 amegfi (0.29 0.14 0.14 0.14 0.29) *
                    1657) hab_marsh=TRUE 1   0 blujay (0 0 1 0 0) *
                   829) yard_type_landsca=FALSE 2   1 bkcchi (0 0.5 0 0 0.5) *
                 415) hab_park=TRUE 6   2 blujay (0 0 0.67 0 0.33) *
        13) hab_dcid_woods=FALSE 44  33 bkcchi (0.16 0.25 0.2 0.18 0.2)  
          26) hab_young_woods=TRUE 12   6 bkcchi (0.25 0.5 0.083 0.083 0.083)  
            52) cats=TRUE 4   1 amegfi (0.75 0.25 0 0 0) *
            53) cats=FALSE 8   3 bkcchi (0 0.62 0.12 0.12 0.12)  
             106) hab_agricultural=FALSE 7   2 bkcchi (0 0.71 0.14 0 0.14) *
             107) hab_agricultural=TRUE 1   0 daejun (0 0 0 1 0) *
          27) hab_young_woods=FALSE 32  24 blujay (0.12 0.16 0.25 0.22 0.25)  
            54) humans=TRUE 30  22 blujay (0.13 0.17 0.27 0.23 0.2)  
             108) yard_type_landsca=FALSE 7   5 amegfi (0.29 0.29 0.29 0 0.14)  
               216) hab_agricultural=TRUE 1   0 bkcchi (0 1 0 0 0) *
               217) hab_agricultural=FALSE 6   4 amegfi (0.33 0.17 0.33 0 0.17) *
             109) yard_type_landsca=TRUE 23  16 daejun (0.087 0.13 0.26 0.3 0.22)  
               218) housing_density&lt; 1.5 3   1 daejun (0 0.33 0 0.67 0) *
               219) housing_density&gt;=1.5 20  14 blujay (0.1 0.1 0.3 0.25 0.25)  
                 438) hab_industrial=FALSE 19  13 blujay (0.11 0.11 0.32 0.21 0.26)  
                   876) hab_swamp=FALSE 18  12 blujay (0.11 0.11 0.33 0.17 0.28) *
                   877) hab_swamp=TRUE 1   0 daejun (0 0 0 1 0) *
                 439) hab_industrial=TRUE 1   0 daejun (0 0 0 1 0) *
            55) humans=FALSE 2   0 tuftit (0 0 0 0 1) *
       7) yard_type_woods=FALSE 17   9 daejun (0.24 0.12 0.12 0.47 0.059)  
        14) hab_young_woods=TRUE 6   3 amegfi (0.5 0.17 0.17 0.17 0)  
          28) yard_type_landsca=FALSE 5   2 amegfi (0.6 0.2 0 0.2 0) *
          29) yard_type_landsca=TRUE 1   0 blujay (0 0 1 0 0) *
        15) hab_young_woods=FALSE 11   4 daejun (0.091 0.091 0.091 0.64 0.091)  
          30) hab_agricultural=TRUE 6   1 daejun (0.17 0 0 0.83 0) *
          31) hab_agricultural=FALSE 5   3 daejun (0 0.2 0.2 0.4 0.2)  
            62) hab_mixed_woods=FALSE 4   2 daejun (0 0.25 0.25 0.5 0) *
            63) hab_mixed_woods=TRUE 1   0 tuftit (0 0 0 0 1) *</code></pre>
</div>
</div>
<p>Training error on tree with pre-pruning</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(tree_default, bird_df) <span class="sc">|&gt;</span> <span class="fu">head</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  amegfi    bkcchi    blujay    daejun    tuftit
OBS1016108597 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913
OBS1103063749 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913
OBS1155529086 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913
OBS1043705011 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913
OBS1043705010 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913
OBS1074366638 0.08695652 0.1304348 0.4347826 0.1304348 0.2173913</code></pre>
</div>
</div>
<p>Does not appear to be doing a good good predicting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_default, bird_df, <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OBS1016108597 OBS1103063749 OBS1155529086 OBS1043705011 OBS1043705010 
       blujay        blujay        blujay        blujay        blujay 
OBS1074366638 
       blujay 
Levels: amegfi bkcchi blujay daejun tuftit</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>confusion_table <span class="ot">&lt;-</span> <span class="fu">with</span>(bird_df, <span class="fu">table</span>(species, pred))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>confusion_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        pred
species  amegfi bkcchi blujay daejun tuftit
  amegfi     26      8     11     12      0
  bkcchi      4     23     16     10      0
  blujay      8      3     33      7      0
  daejun      5      5     12     38      0
  tuftit      9      2     15      3      0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> confusion_table <span class="sc">|&gt;</span> <span class="fu">diag</span>() <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>correct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 120</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> confusion_table <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">-</span> correct</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 130</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> correct <span class="sc">/</span> (correct <span class="sc">+</span> error)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.48</code></pre>
</div>
</div>
<p>Not a very good result with an accuracy of just over 50%</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(truth, prediction) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(truth, prediction)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">diag</span>(tbl))<span class="sc">/</span><span class="fu">sum</span>(tbl)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(bird_df <span class="sc">|&gt;</span> <span class="fu">pull</span>(species), pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.48</code></pre>
</div>
</div>
<p>Training error of the full tree</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(bird_df <span class="sc">|&gt;</span> <span class="fu">pull</span>(species),</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(tree_full, bird_df, <span class="at">type=</span><span class="st">"class"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.644</code></pre>
</div>
</div>
<p>Still not great. Probably a good sign that the variables selected cannot be used to predict the bird species observed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred, </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">reference =</span> bird_df <span class="sc">|&gt;</span> <span class="fu">pull</span>(species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction amegfi bkcchi blujay daejun tuftit
    amegfi     26      4      8      5      9
    bkcchi      8     23      3      5      2
    blujay     11     16     33     12     15
    daejun     12     10      7     38      3
    tuftit      0      0      0      0      0

Overall Statistics
                                          
               Accuracy : 0.48            
                 95% CI : (0.4166, 0.5438)
    No Information Rate : 0.24            
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.333           
                                          
 Mcnemar's Test P-Value : 1.718e-06       

Statistics by Class:

                     Class: amegfi Class: bkcchi Class: blujay Class: daejun
Sensitivity                 0.4561        0.4340        0.6471        0.6333
Specificity                 0.8653        0.9086        0.7286        0.8316
Pos Pred Value              0.5000        0.5610        0.3793        0.5429
Neg Pred Value              0.8434        0.8565        0.8896        0.8778
Prevalence                  0.2280        0.2120        0.2040        0.2400
Detection Rate              0.1040        0.0920        0.1320        0.1520
Detection Prevalence        0.2080        0.1640        0.3480        0.2800
Balanced Accuracy           0.6607        0.6713        0.6879        0.7325
                     Class: tuftit
Sensitivity                  0.000
Specificity                  1.000
Pos Pred Value                 NaN
Neg Pred Value               0.884
Prevalence                   0.116
Detection Rate               0.000
Detection Prevalence         0.000
Balanced Accuracy            0.500</code></pre>
</div>
</div>
</section>
<section id="make-predictions-for-new-data" class="level3">
<h3 class="anchored" data-anchor-id="make-predictions-for-new-data"><strong>Make Predictions for New Data</strong></h3>
<p>Make up my own animal: A lion with feathered wings</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>my_bird <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species =</span> <span class="cn">NA</span>, <span class="at">yard_type_landsca =</span> <span class="cn">TRUE</span>, <span class="at">yard_type_woods =</span> <span class="cn">FALSE</span>, <span class="at">hab_dcid_woods=</span><span class="cn">FALSE</span>,<span class="at">hab_mixed_woods=</span><span class="cn">TRUE</span>,<span class="at">hab_park=</span><span class="cn">TRUE</span>, <span class="at">hab_water_fresh=</span><span class="cn">FALSE</span>, <span class="at">hab_industrial=</span><span class="cn">TRUE</span>, <span class="at">hab_agricultural=</span><span class="cn">FALSE</span>, <span class="at">hab_young_woods=</span><span class="cn">TRUE</span>, <span class="at">hab_swamp=</span><span class="cn">FALSE</span>, <span class="at">hab_marsh=</span><span class="cn">FALSE</span>, <span class="at">nearby_feeders=</span><span class="cn">TRUE</span>, <span class="at">cats=</span><span class="cn">FALSE</span>, <span class="at">dogs=</span><span class="cn">TRUE</span>, <span class="at">humans=</span><span class="cn">TRUE</span>, <span class="at">housing_density=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fix columns to be factors like in the training set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>my_bird <span class="ot">&lt;-</span> my_bird <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), factor, <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>my_bird</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 17
  species yard_type_landsca yard_type_woods hab_dcid_woods hab_mixed_woods
  &lt;fct&gt;   &lt;fct&gt;             &lt;fct&gt;           &lt;fct&gt;          &lt;fct&gt;          
1 &lt;NA&gt;    TRUE              FALSE           FALSE          TRUE           
# ℹ 12 more variables: hab_park &lt;fct&gt;, hab_water_fresh &lt;fct&gt;,
#   hab_industrial &lt;fct&gt;, hab_agricultural &lt;fct&gt;, hab_young_woods &lt;fct&gt;,
#   hab_swamp &lt;fct&gt;, hab_marsh &lt;fct&gt;, nearby_feeders &lt;fct&gt;, cats &lt;fct&gt;,
#   dogs &lt;fct&gt;, humans &lt;fct&gt;, housing_density &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Make a prediction using the default tree</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(tree_default , my_bird, <span class="at">type =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1 
bkcchi 
Levels: amegfi bkcchi blujay daejun tuftit</code></pre>
</div>
</div>
</section>
</section>
<section id="model-evaluation-with-caret" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-with-caret"><strong>Model Evaluation with Caret</strong></h2>
<p>The package <a href="https://topepo.github.io/caret/"><code>caret</code></a> makes preparing training sets, building classification (and regression) models and evaluation easier. A great cheat sheet can be found <a href="https://ugoproto.github.io/ugo_r_doc/pdf/caret.pdf">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set random number generator seed to make results reproducible</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="hold-out-test-data" class="level3">
<h3 class="anchored" data-anchor-id="hold-out-test-data"><strong>Hold out Test Data</strong></h3>
<p>Test data is not used in the model building process and set aside purely for testing the model. Here, we partition data the 80% training and 20% testing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create training data frame</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> bird_df<span class="sc">$</span>species, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>bird_train <span class="ot">&lt;-</span> bird_df <span class="sc">|&gt;</span> <span class="fu">slice</span>(inTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Slicing with a 1-column matrix was deprecated in dplyr 1.1.0.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create testing data set</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>bird_test <span class="ot">&lt;-</span> bird_df <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="sc">-</span>inTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="learn-a-model-and-tune-hyperparameters-on-the-training-data" class="level3">
<h3 class="anchored" data-anchor-id="learn-a-model-and-tune-hyperparameters-on-the-training-data"><strong>Learn a Model and Tune Hyperparameters on the Training Data</strong></h3>
<p>The package <code>caret</code> combines training and validation for hyperparameter tuning into a single function called <code>train()</code>. It internally splits the data into training and validation sets and thus will provide you with error estimates for different hyperparameter settings. <code>trainControl</code> is used to choose how testing is performed.</p>
<p>For rpart, train tries to tune the <code>cp</code> parameter (tree complexity) using accuracy to chose the best model. I set <code>minsplit</code> to 10 in order to get more interesting results as 2 was to low and no tree structure was produce. <strong>Note:</strong> Parameters used for tuning (in this case <code>cp</code>) need to be set using a data.frame in the argument <code>tuneGrid</code>! Setting it in control will be ignored.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _ ,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">10</span>),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneLength =</span> <span class="dv">5</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

202 samples
 16 predictor
  5 classes: 'amegfi', 'bkcchi', 'blujay', 'daejun', 'tuftit' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 182, 183, 181, 181, 183, 183, ... 
Resampling results across tuning parameters:

  cp          Accuracy   Kappa      
  0.02272727  0.2677820  0.067473460
  0.02597403  0.2625188  0.059092557
  0.03246753  0.2672556  0.064416944
  0.03896104  0.2670175  0.064700347
  0.07792208  0.2332080  0.009424258

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was cp = 0.02272727.</code></pre>
</div>
</div>
<p><strong>Note:</strong> Train has built 10 trees using the training folds for each value of <code>cp</code> and the reported values for accuracy and Kappa are the averages on the validation folds.</p>
<p>A model using the best tuning parameters and using all the data supplied to <code>train()</code> is available as <code>fit$finalModel</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">box.palette =</span> <span class="fu">list</span>(<span class="st">"Gy"</span>, <span class="st">"Gn"</span>, <span class="st">"Bu"</span>, <span class="st">"Bn"</span>, <span class="st">"Or"</span>, <span class="st">"Rd"</span>, <span class="st">"Pu"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I am surprised by this result as I excepted to have more of tree structure despite the low accuracy and kappa.</p>
<p>caret also computes variable importance. By default it uses competing splits (splits which would be runners up, but do not get chosen by the tree) for rpart models (see&nbsp;<code>? varImp</code>). Toothed is the runner up for many splits, but it never gets chosen!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rpart variable importance

                       Overall
hab_dcid_woodsFALSE     100.00
hab_marshFALSE           97.37
housing_density          89.56
nearby_feedersFALSE      77.89
hab_water_freshFALSE     72.09
yard_type_woodsFALSE     69.04
hab_parkFALSE            32.64
yard_type_landscaFALSE   21.69
hab_mixed_woodsFALSE     20.40
hab_swampFALSE            0.00
humansFALSE               0.00
hab_young_woodsFALSE      0.00
dogsFALSE                 0.00
catsFALSE                 0.00
hab_agriculturalFALSE     0.00
hab_industrialFALSE       0.00</code></pre>
</div>
</div>
<p>Here is the variable importance without competing splits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">varImp</span>(fit, <span class="at">compete =</span> <span class="cn">FALSE</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rpart variable importance

                       Overall
hab_water_freshFALSE    100.00
hab_marshFALSE           74.23
yard_type_woodsFALSE     50.76
hab_dcid_woodsFALSE      38.55
yard_type_landscaFALSE    0.00
housing_density           0.00
catsFALSE                 0.00
humansFALSE               0.00
hab_industrialFALSE       0.00
hab_swampFALSE            0.00
hab_agriculturalFALSE     0.00
nearby_feedersFALSE       0.00
hab_mixed_woodsFALSE      0.00
hab_young_woodsFALSE      0.00
dogsFALSE                 0.00
hab_parkFALSE             0.00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This may help explain the poor accuracy</p>
</section>
</section>
<section id="testing-confusion-matrix-and-confidence-interval-for-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="testing-confusion-matrix-and-confidence-interval-for-accuracy"><strong>Testing: Confusion Matrix and Confidence Interval for Accuracy</strong></h2>
<p>Use the best model on the test data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> bird_test)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] blujay daejun blujay daejun bkcchi daejun daejun blujay blujay daejun
[11] daejun bkcchi bkcchi bkcchi bkcchi daejun daejun daejun daejun blujay
[21] blujay daejun daejun daejun bkcchi blujay blujay blujay blujay blujay
[31] daejun blujay bkcchi bkcchi bkcchi blujay blujay daejun daejun daejun
[41] daejun bkcchi blujay blujay daejun daejun daejun bkcchi
Levels: amegfi bkcchi blujay daejun tuftit</code></pre>
</div>
</div>
<p>Caret’s&nbsp;<code>confusionMatrix()</code>&nbsp;function calculates accuracy, confidence intervals, kappa and many more evaluation metrics. You need to use separate test data to create a confusion matrix based on the generalization error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred, </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> bird_test <span class="sc">|&gt;</span> <span class="fu">pull</span>(species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction amegfi bkcchi blujay daejun tuftit
    amegfi      0      0      0      0      0
    bkcchi      2      3      3      2      1
    blujay      6      3      3      2      2
    daejun      3      4      4      8      2
    tuftit      0      0      0      0      0

Overall Statistics
                                          
               Accuracy : 0.2917          
                 95% CI : (0.1695, 0.4406)
    No Information Rate : 0.25            
    P-Value [Acc &gt; NIR] : 0.3014          
                                          
                  Kappa : 0.0842          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: amegfi Class: bkcchi Class: blujay Class: daejun
Sensitivity                 0.0000        0.3000        0.3000        0.6667
Specificity                 1.0000        0.7895        0.6579        0.6389
Pos Pred Value                 NaN        0.2727        0.1875        0.3810
Neg Pred Value              0.7708        0.8108        0.7812        0.8519
Prevalence                  0.2292        0.2083        0.2083        0.2500
Detection Rate              0.0000        0.0625        0.0625        0.1667
Detection Prevalence        0.0000        0.2292        0.3333        0.4375
Balanced Accuracy           0.5000        0.5447        0.4789        0.6528
                     Class: tuftit
Sensitivity                 0.0000
Specificity                 1.0000
Pos Pred Value                 NaN
Neg Pred Value              0.8958
Prevalence                  0.1042
Detection Rate              0.0000
Detection Prevalence        0.0000
Balanced Accuracy           0.5000</code></pre>
</div>
</div>
<p>This has low accuracy and even lower kappa score. The p-value is also not significant and e cannot reject the null hypothesis.</p>
</section>
<section id="model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison"><strong>Model Comparison</strong></h2>
<p>We will compare decision trees with a k-nearest neighbors (kNN) classifier. We will create fixed sampling scheme (10-folds) so we compare the different models using exactly the same folds. It is specified as <code>trControl</code> during training.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(bird_train<span class="sc">$</span>species, <span class="at">k =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Build models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>rpartFit <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">tuneLength =</span> <span class="dv">10</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">indexOut =</span> train_index)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note:</strong>&nbsp;for kNN we ask&nbsp;<code>train</code>&nbsp;to scale the data using&nbsp;<code>preProcess = "scale"</code>. Logicals will be used as 0-1 variables in Euclidean distance calculation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>knnFit <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">preProcess =</span> <span class="st">"scale"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">tuneLength =</span> <span class="dv">10</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">indexOut =</span> train_index)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare accuracy over all folds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>resamps <span class="ot">&lt;-</span> <span class="fu">resamples</span>(<span class="fu">list</span>(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">CART =</span> rpartFit,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">kNearestNeighbors =</span> knnFit</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resamps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = resamps)

Models: CART, kNearestNeighbors 
Number of resamples: 10 

Accuracy 
                       Min. 1st Qu.    Median      Mean   3rd Qu.      Max.
CART              0.3684211  0.4000 0.4522727 0.4701914 0.5375000 0.6190476
kNearestNeighbors 0.3000000  0.3875 0.5238095 0.4887810 0.5488636 0.7000000
                  NA's
CART                 0
kNearestNeighbors    0

Kappa 
                       Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
CART              0.1886121 0.2326007 0.3061461 0.3244008 0.4106569 0.5200000
kNearestNeighbors 0.1111111 0.2055928 0.3913043 0.3452031 0.4244961 0.6226415
                  NA's
CART                 0
kNearestNeighbors    0</code></pre>
</div>
</div>
<p><code>caret</code>&nbsp;provides some visualizations using the package&nbsp;<code>lattice</code>. For example, a boxplot to compare the accuracy and kappa distribution (over the 10 folds).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(resamps, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I would say in that both of these models preform rather poorly but if I had to pick one the kNearestNeighbors has small whiskers(less variance) and that is the one I would use.</p>
<p>Find out if one models is statistically better than the other (is the difference in accuracy is not zero).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>difs <span class="ot">&lt;-</span> <span class="fu">diff</span>(resamps)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>difs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
diff.resamples(x = resamps)

Models: CART, kNearestNeighbors 
Metrics: Accuracy, Kappa 
Number of differences: 1 
p-value adjustment: bonferroni </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(difs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.diff.resamples(object = difs)

p-value adjustment: bonferroni 
Upper diagonal: estimates of the difference
Lower diagonal: p-value for H0: difference = 0

Accuracy 
                  CART   kNearestNeighbors
CART                     -0.01859         
kNearestNeighbors 0.7388                  

Kappa 
                  CART   kNearestNeighbors
CART                     -0.0208          
kNearestNeighbors 0.7754                  </code></pre>
</div>
</div>
<p>p-values tells you the probability of seeing an even more extreme value (difference between accuracy) given that the null hypothesis (difference = 0) is true. For a better classifier, the p-value should be less than .05 or 0.01.&nbsp;<code>diff</code>&nbsp;automatically applies Bonferroni correction for multiple comparisons. In this case, kNN seems better but the classifiers do not perform statistically differently. Here we can see that neither model has a p-value less than .05 and a diff much closer to 0.</p>
</section>
<section id="feature-selection-and-feature-preparation" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection-and-feature-preparation"><strong>Feature Selection and Feature Preparation</strong></h2>
<p>Decision trees implicitly select features for splitting, but we can also select features manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSelector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="univariate-feature-importance-score" class="level3">
<h3 class="anchored" data-anchor-id="univariate-feature-importance-score"><strong>Univariate Feature Importance Score</strong></h3>
<p>These scores measure how related each feature is to the class variable. For discrete features (as in our case), the chi-square statistic can be used to derive a score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chi.squared</span>(species <span class="sc">~</span> ., <span class="at">data =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"feature"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(attr_importance))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   feature           attr_importance
   &lt;chr&gt;                       &lt;dbl&gt;
 1 hab_water_fresh            0.333 
 2 hab_dcid_woods             0.249 
 3 hab_marsh                  0.241 
 4 nearby_feeders             0.173 
 5 hab_park                   0.170 
 6 hab_young_woods            0.164 
 7 yard_type_woods            0.158 
 8 humans                     0.151 
 9 hab_agricultural           0.140 
10 cats                       0.139 
11 hab_mixed_woods            0.133 
12 yard_type_landsca          0.111 
13 hab_swamp                  0.107 
14 hab_industrial             0.0932
15 dogs                       0.0828
16 housing_density            0     </code></pre>
</div>
</div>
<p>plot importance in descending order (using&nbsp;<code>reorder</code>&nbsp;to order factor levels used by&nbsp;<code>ggplot</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> attr_importance, <span class="at">y =</span> <span class="fu">reorder</span>(feature, attr_importance))) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Importance score"</span>) <span class="sc">+</span> </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Feature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The highest weight is less than 0.4. We will still get the best 5 features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>subset <span class="ot">&lt;-</span> <span class="fu">cutoff.k</span>(weights <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column_to_rownames</span>(<span class="st">"feature"</span>), <span class="dv">5</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>subset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hab_water_fresh" "hab_dcid_woods"  "hab_marsh"       "nearby_feeders" 
[5] "hab_park"       </code></pre>
</div>
</div>
<p>Use only the best 5 features to build a model (<code>Fselector</code>&nbsp;provides&nbsp;<code>as.simple.formula</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">as.simple.formula</span>(subset, <span class="st">"species"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>species ~ hab_water_fresh + hab_dcid_woods + hab_marsh + nearby_feeders + 
    hab_park
&lt;environment: 0x000002881e53f200&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> <span class="fu">rpart</span>(f, <span class="at">data =</span> _)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(m, <span class="at">extra =</span> <span class="dv">2</span>, <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are many alternative ways to calculate univariate importance scores (see package FSelector). Some of them (also) work for continuous features. One example is the information gain ratio based on entropy as used in decision tree induction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>bird_train <span class="sc">|&gt;</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gain.ratio</span>(species <span class="sc">~</span> ., <span class="at">data =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"feature"</span>) <span class="sc">|&gt;</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(attr_importance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   feature           attr_importance
   &lt;chr&gt;                       &lt;dbl&gt;
 1 hab_water_fresh           0.0869 
 2 hab_marsh                 0.0629 
 3 hab_dcid_woods            0.0454 
 4 humans                    0.0331 
 5 yard_type_woods           0.0245 
 6 nearby_feeders            0.0216 
 7 hab_park                  0.0211 
 8 hab_young_woods           0.0210 
 9 yard_type_landsca         0.0198 
10 hab_mixed_woods           0.0179 
11 hab_agricultural          0.0158 
12 cats                      0.0149 
13 hab_swamp                 0.0120 
14 hab_industrial            0.00710
15 dogs                      0.00496
16 housing_density           0      </code></pre>
</div>
</div>
<p>I probably picked the wrong dataset for this HW as I am running out of ways to says that these attributes are not good for predicting the type of bird species.</p>
</section>
<section id="feature-subset-selection" class="level3">
<h3 class="anchored" data-anchor-id="feature-subset-selection"><strong>Feature Subset Selection</strong></h3>
<p>Often features are related and calculating importance for each feature independently is not optimal. We can use greedy search heuristics. For example <code>cfs</code> uses correlation/entropy with best first search.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>bird_train <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cfs</span>(species <span class="sc">~</span> ., <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hab_dcid_woods"  "hab_water_fresh" "hab_marsh"      </code></pre>
</div>
</div>
<p>Black-box feature selection uses an evaluator function (the black box) to calculate a score to be maximized. First, we define an evaluation function that builds a model given a subset of features and calculates a quality score. We use here the average for 5 bootstrap samples (<code>method = "cv"</code>&nbsp;can also be used instead), no tuning (to be faster), and the average accuracy as the score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>evaluator <span class="ot">&lt;-</span> <span class="cf">function</span>(subset) {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">train</span>(<span class="fu">as.simple.formula</span>(subset, <span class="st">"species"</span>),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> _,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"boot"</span>, <span class="at">number =</span> <span class="dv">5</span>),</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">tuneLength =</span> <span class="dv">0</span>)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> model<span class="sc">$</span>resample<span class="sc">$</span>Accuracy</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Trying features:"</span>, <span class="fu">paste</span>(subset, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">mean</span>(results)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(m, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  m</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start with all features (but not the class variable&nbsp;species)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> <span class="fu">colnames</span>() <span class="sc">|&gt;</span> <span class="fu">setdiff</span>(<span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are several (greedy) search strategies available. These run for a while!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>subset_1 <span class="ot">&lt;-</span> <span class="fu">backward.search</span>(features, evaluator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.27 

Trying features: yard_type_landsca + yard_type_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.19 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.18 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.26 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.23 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.23 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + dogs + humans + housing_density 
Accuracy: 0.18 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + housing_density 
Accuracy: 0.18 

Trying features: yard_type_landsca + yard_type_woods + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans 
Accuracy: 0.21 

Trying features: hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_dcid_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.25 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_marsh + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + nearby_feeders + cats + dogs + humans + housing_density 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + cats + dogs + humans + housing_density 
Accuracy: 0.16 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + dogs + humans + housing_density 
Accuracy: 0.24 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + humans + housing_density 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + housing_density 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_dcid_woods + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_swamp + hab_marsh + nearby_feeders + cats + dogs + humans 
Accuracy: 0.23 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>subset_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "yard_type_landsca" "hab_dcid_woods"    "hab_mixed_woods"  
 [4] "hab_park"          "hab_water_fresh"   "hab_industrial"   
 [7] "hab_agricultural"  "hab_young_woods"   "hab_swamp"        
[10] "hab_marsh"         "nearby_feeders"    "cats"             
[13] "dogs"              "humans"            "housing_density"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>subset_2 <span class="ot">&lt;-</span> <span class="fu">forward.search</span>(features, evaluator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trying features: yard_type_landsca 
Accuracy: 0.17 

Trying features: yard_type_woods 
Accuracy: 0.21 

Trying features: hab_dcid_woods 
Accuracy: 0.22 

Trying features: hab_mixed_woods 
Accuracy: 0.22 

Trying features: hab_park 
Accuracy: 0.16 

Trying features: hab_water_fresh 
Accuracy: 0.2 

Trying features: hab_industrial 
Accuracy: 0.18 

Trying features: hab_agricultural 
Accuracy: 0.19 

Trying features: hab_young_woods 
Accuracy: 0.22 

Trying features: hab_swamp 
Accuracy: 0.21 

Trying features: hab_marsh 
Accuracy: 0.2 

Trying features: nearby_feeders 
Accuracy: 0.21 

Trying features: cats 
Accuracy: 0.23 

Trying features: dogs 
Accuracy: 0.2 

Trying features: humans 
Accuracy: 0.21 

Trying features: housing_density 
Accuracy: 0.16 

Trying features: yard_type_landsca + cats 
Accuracy: 0.17 

Trying features: yard_type_woods + cats 
Accuracy: 0.18 

Trying features: hab_dcid_woods + cats 
Accuracy: 0.22 

Trying features: hab_mixed_woods + cats 
Accuracy: 0.17 

Trying features: hab_park + cats 
Accuracy: 0.23 

Trying features: hab_water_fresh + cats 
Accuracy: 0.21 

Trying features: hab_industrial + cats 
Accuracy: 0.16 

Trying features: hab_agricultural + cats 
Accuracy: 0.23 

Trying features: hab_young_woods + cats 
Accuracy: 0.22 

Trying features: hab_swamp + cats 
Accuracy: 0.21 

Trying features: hab_marsh + cats 
Accuracy: 0.22 

Trying features: nearby_feeders + cats 
Accuracy: 0.22 

Trying features: cats + dogs 
Accuracy: 0.16 

Trying features: cats + humans 
Accuracy: 0.17 

Trying features: cats + housing_density 
Accuracy: 0.21 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>subset_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cats"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>subset_3 <span class="ot">&lt;-</span> <span class="fu">best.first.search</span>(features, evaluator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trying features: yard_type_landsca 
Accuracy: 0.19 

Trying features: yard_type_woods 
Accuracy: 0.2 

Trying features: hab_dcid_woods 
Accuracy: 0.22 

Trying features: hab_mixed_woods 
Accuracy: 0.18 

Trying features: hab_park 
Accuracy: 0.22 

Trying features: hab_water_fresh 
Accuracy: 0.22 

Trying features: hab_industrial 
Accuracy: 0.17 

Trying features: hab_agricultural 
Accuracy: 0.22 

Trying features: hab_young_woods 
Accuracy: 0.24 

Trying features: hab_swamp 
Accuracy: 0.17 

Trying features: hab_marsh 
Accuracy: 0.19 

Trying features: nearby_feeders 
Accuracy: 0.23 

Trying features: cats 
Accuracy: 0.19 

Trying features: dogs 
Accuracy: 0.19 

Trying features: humans 
Accuracy: 0.18 

Trying features: housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_young_woods 
Accuracy: 0.22 

Trying features: yard_type_woods + hab_young_woods 
Accuracy: 0.23 

Trying features: hab_dcid_woods + hab_young_woods 
Accuracy: 0.19 

Trying features: hab_mixed_woods + hab_young_woods 
Accuracy: 0.22 

Trying features: hab_park + hab_young_woods 
Accuracy: 0.19 

Trying features: hab_water_fresh + hab_young_woods 
Accuracy: 0.21 

Trying features: hab_industrial + hab_young_woods 
Accuracy: 0.21 

Trying features: hab_agricultural + hab_young_woods 
Accuracy: 0.22 

Trying features: hab_young_woods + hab_swamp 
Accuracy: 0.21 

Trying features: hab_young_woods + hab_marsh 
Accuracy: 0.25 

Trying features: hab_young_woods + nearby_feeders 
Accuracy: 0.21 

Trying features: hab_young_woods + cats 
Accuracy: 0.22 

Trying features: hab_young_woods + dogs 
Accuracy: 0.21 

Trying features: hab_young_woods + humans 
Accuracy: 0.21 

Trying features: hab_young_woods + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_young_woods + hab_marsh 
Accuracy: 0.18 

Trying features: yard_type_woods + hab_young_woods + hab_marsh 
Accuracy: 0.18 

Trying features: hab_dcid_woods + hab_young_woods + hab_marsh 
Accuracy: 0.23 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh 
Accuracy: 0.26 

Trying features: hab_park + hab_young_woods + hab_marsh 
Accuracy: 0.23 

Trying features: hab_water_fresh + hab_young_woods + hab_marsh 
Accuracy: 0.2 

Trying features: hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.24 

Trying features: hab_agricultural + hab_young_woods + hab_marsh 
Accuracy: 0.17 

Trying features: hab_young_woods + hab_swamp + hab_marsh 
Accuracy: 0.19 

Trying features: hab_young_woods + hab_marsh + nearby_feeders 
Accuracy: 0.22 

Trying features: hab_young_woods + hab_marsh + cats 
Accuracy: 0.23 

Trying features: hab_young_woods + hab_marsh + dogs 
Accuracy: 0.18 

Trying features: hab_young_woods + hab_marsh + humans 
Accuracy: 0.21 

Trying features: hab_young_woods + hab_marsh + housing_density 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_mixed_woods + hab_young_woods + hab_marsh 
Accuracy: 0.21 

Trying features: yard_type_woods + hab_mixed_woods + hab_young_woods + hab_marsh 
Accuracy: 0.2 

Trying features: hab_dcid_woods + hab_mixed_woods + hab_young_woods + hab_marsh 
Accuracy: 0.26 

Trying features: hab_mixed_woods + hab_park + hab_young_woods + hab_marsh 
Accuracy: 0.19 

Trying features: hab_mixed_woods + hab_water_fresh + hab_young_woods + hab_marsh 
Accuracy: 0.2 

Trying features: hab_mixed_woods + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.19 

Trying features: hab_mixed_woods + hab_agricultural + hab_young_woods + hab_marsh 
Accuracy: 0.18 

Trying features: hab_mixed_woods + hab_young_woods + hab_swamp + hab_marsh 
Accuracy: 0.22 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh + nearby_feeders 
Accuracy: 0.21 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh + cats 
Accuracy: 0.26 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh + dogs 
Accuracy: 0.23 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh + humans 
Accuracy: 0.21 

Trying features: hab_mixed_woods + hab_young_woods + hab_marsh + housing_density 
Accuracy: 0.22 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>subset_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hab_mixed_woods" "hab_young_woods" "hab_marsh"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>subset_4 <span class="ot">&lt;-</span> <span class="fu">hill.climbing.search</span>(features, evaluator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.24 

Trying features: yard_type_landsca + yard_type_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_dcid_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.18 

Trying features: yard_type_landsca + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_marsh 
Accuracy: 0.25 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_swamp + hab_marsh 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + nearby_feeders 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.25 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + dogs 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + humans 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + housing_density 
Accuracy: 0.21 

Trying features: hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_park + hab_industrial + hab_young_woods + hab_marsh 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_young_woods + hab_marsh 
Accuracy: 0.24 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_marsh 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods 
Accuracy: 0.21 

Trying features: yard_type_landsca + yard_type_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.24 

Trying features: yard_type_landsca + hab_dcid_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.21 

Trying features: yard_type_landsca + hab_mixed_woods + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_agricultural + hab_young_woods + hab_marsh + cats 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_swamp + hab_marsh + cats 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + nearby_feeders + cats 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats + dogs 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats + humans 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats + housing_density 
Accuracy: 0.22 

Trying features: hab_park + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_water_fresh + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.22 

Trying features: yard_type_landsca + hab_park + hab_industrial + hab_young_woods + hab_marsh + cats 
Accuracy: 0.23 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_young_woods + hab_marsh + cats 
Accuracy: 0.2 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_marsh + cats 
Accuracy: 0.19 

Trying features: yard_type_landsca + hab_park + hab_water_fresh + hab_industrial + hab_young_woods + cats 
Accuracy: 0.19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>subset_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "yard_type_landsca" "hab_park"          "hab_water_fresh"  
[4] "hab_industrial"    "hab_young_woods"   "hab_marsh"        
[7] "cats"             </code></pre>
</div>
</div>
<p>It appears that hill climbing (subset_4) gave the best accuracy with four features at 29%.</p>
</section>
<section id="using-dummy-variables-for-factors" class="level3">
<h3 class="anchored" data-anchor-id="using-dummy-variables-for-factors"><strong>Using Dummy Variables for Factors</strong></h3>
<p>Nominal features (factors) are often encoded as a series of 0-1 dummy variables. For example, let us try to predict if an bird lives in hab_park given the species. First we use the original encoding of type as a factor with several values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tree_hab_park <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart</span>(hab_park <span class="sc">~</span> species, <span class="at">data =</span> _)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_hab_park, <span class="at">extra =</span> <span class="dv">2</span>, <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Note:</strong> Some splits use multiple values. Building the tree will become extremely slow if a factor has many levels (different values) since the tree has to check all possible splits into two subsets. This situation should be avoided.</p>
<p>Convert type into a set of 0-1 dummy variables using <code>class2ind</code>. See also <code>? dummyVars</code> in package <code>caret</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>bird_train_dummy <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">class2ind</span>(bird_train<span class="sc">$</span>species)) <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.factor)) <span class="sc">|&gt;</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">hab_park =</span> bird_train<span class="sc">$</span>hab_park)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>bird_train_dummy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 202 × 6
   amegfi bkcchi blujay daejun tuftit hab_park
   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;   
 1 0      0      0      1      0      FALSE   
 2 0      0      0      1      0      FALSE   
 3 0      1      0      0      0      FALSE   
 4 0      0      1      0      0      FALSE   
 5 0      0      1      0      0      FALSE   
 6 0      0      0      1      0      FALSE   
 7 0      1      0      0      0      FALSE   
 8 0      0      0      1      0      FALSE   
 9 0      0      1      0      0      TRUE    
10 0      0      0      0      1      TRUE    
# ℹ 192 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>tree_hab_park <span class="ot">&lt;-</span> bird_train_dummy <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart</span>(hab_park<span class="sc">~</span>.,</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data=</span>_,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">control=</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">2</span>, <span class="at">cp =</span><span class="fl">0.01</span>))</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_hab_park, <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> bird_train <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(hab_park <span class="sc">~</span> species, </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _, </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">2</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">cp =</span> <span class="fl">0.01</span>))</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

202 samples
  1 predictor
  2 classes: 'TRUE', 'FALSE' 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 202, 202, 202, 202, 202, 202, ... 
Resampling results:

  Accuracy   Kappa     
  0.5119417  0.03832419

Tuning parameter 'cp' was held constant at a value of 0.01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So species is not a good predictor of hab_park, as it seems to be a flip of the coin.</p>
</section>
</section>
<section id="class-imbalance" class="level2">
<h2 class="anchored" data-anchor-id="class-imbalance"><strong>Class Imbalance</strong></h2>
<p>Classifiers have a hard time to learn from data where we have much more observations for one class (called the majority class). This is called the class imbalance problem.</p>
<p>Here is a very good <a href="http://www.kdnuggets.com/2016/08/learning-from-imbalanced-classes.html">article about the problem and solutions.</a></p>
<p>Class distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bird_df, <span class="fu">aes</span>(<span class="at">y=</span>species))<span class="sc">+</span><span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To create an imbalanced problem, we want to decide if a bird is an tuftit. First, we change the class variable to make it into a binary tuftit/no tuftit classification problem.&nbsp;<strong>Note:</strong>&nbsp;We use here the training data for testing. You should use a separate testing data set!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new dataset</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>bird_tuftit <span class="ot">&lt;-</span> bird_df <span class="sc">|&gt;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> <span class="fu">factor</span>(bird_df<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"tuftit"</span>,</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"nontuftit"</span>, <span class="st">"tuftit"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bird_tuftit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      species    yard_type_landsca yard_type_woods hab_dcid_woods
 nontuftit:221   TRUE :222         TRUE :192       TRUE :123     
 tuftit   : 29   FALSE: 28         FALSE: 58       FALSE:127     
                                                                 
                                                                 
                                                                 
                                                                 
 hab_mixed_woods  hab_park   hab_water_fresh hab_industrial hab_agricultural
 TRUE :193       TRUE :115   TRUE :143       TRUE : 71      TRUE : 83       
 FALSE: 57       FALSE:135   FALSE:107       FALSE:179      FALSE:167       
                                                                            
                                                                            
                                                                            
                                                                            
 hab_young_woods hab_swamp   hab_marsh   nearby_feeders    cats        dogs    
 TRUE : 91       TRUE : 44   TRUE : 52   TRUE :123      TRUE : 92   TRUE :132  
 FALSE:159       FALSE:206   FALSE:198   FALSE:127      FALSE:158   FALSE:118  
                                                                               
                                                                               
                                                                               
                                                                               
   humans    housing_density
 TRUE :222   Min.   :1.000  
 FALSE: 28   1st Qu.:1.000  
             Median :2.000  
             Mean   :2.176  
             3rd Qu.:3.000  
             Max.   :4.000  </code></pre>
</div>
</div>
<p>See if we have a class imbalance problem</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bird_tuftit, <span class="fu">aes</span>(<span class="at">y=</span>species))<span class="sc">+</span><span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Create test and training data. I use here a 50/50 split to make sure that the test set has some samples of the rare tuftit class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> bird_tuftit<span class="sc">$</span>species, <span class="at">p =</span> .<span class="dv">5</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>training_tuftit <span class="ot">&lt;-</span> bird_tuftit <span class="sc">|&gt;</span> <span class="fu">slice</span>(inTrain)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>testing_tuftit <span class="ot">&lt;-</span> bird_tuftit <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="sc">-</span>inTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="option-1-use-the-data-as-is-and-hope-for-the-best" class="level3">
<h3 class="anchored" data-anchor-id="option-1-use-the-data-as-is-and-hope-for-the-best"><strong>Option 1: Use the Data As Is and Hope For The Best</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> training_tuftit <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

126 samples
 16 predictor
  2 classes: 'nontuftit', 'tuftit' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 113, 114, 113, 113, 114, 113, ... 
Resampling results:

  Accuracy  Kappa       
  0.874359  -0.008333333

Tuning parameter 'cp' was held constant at a value of 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> <span class="fu">predict</span>(fit, testing_tuftit),</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit       110     14
  tuftit            0      0
                                          
               Accuracy : 0.8871          
                 95% CI : (0.8178, 0.9369)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 0.570564        
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : 0.000512        
                                          
            Sensitivity : 0.0000          
            Specificity : 1.0000          
         Pos Pred Value :    NaN          
         Neg Pred Value : 0.8871          
             Prevalence : 0.1129          
         Detection Rate : 0.0000          
   Detection Prevalence : 0.0000          
      Balanced Accuracy : 0.5000          
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
<p>Accuracy is high, but it is exactly the same as the no-information rate and kappa is zero. Sensitivity is also zero, meaning that we do not identify any positive (tuftit). If the cost of missing a positive is much larger than the cost associated with misclassifying a negative, then accuracy is not a good measure! By dealing with imbalance, we are <strong>not</strong> concerned with accuracy, but we want to increase the sensitivity, i.e., the chance to identify positive examples.</p>
<p><strong>Note:</strong> The positive class value (the one that you want to detect) is set manually to tuftit using <code>positive = "tuftit"</code>. Otherwise sensitivity/specificity will not be correctly calculated.</p>
</section>
<section id="option-2-balance-data-with-resampling" class="level3">
<h3 class="anchored" data-anchor-id="option-2-balance-data-with-resampling"><strong>Option 2: Balance Data With Resampling</strong></h3>
<p>We use stratified sampling with replacement (to oversample the minority/positive class). You could also use SMOTE (in package <strong>DMwR</strong>) or other sampling strategies (e.g., from package <strong>unbalanced</strong>). We use 50+50 observations here (<strong>Note:</strong> many samples will be chosen several times).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>) <span class="co"># for repeatability</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">strata</span>(training_tuftit, <span class="at">stratanames =</span> <span class="st">"species"</span>, <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>), <span class="at">method =</span> <span class="st">"srswr"</span>)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>training_tuftit_balanced <span class="ot">&lt;-</span> training_tuftit <span class="sc">|&gt;</span> </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(id<span class="sc">$</span>ID_unit)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(training_tuftit_balanced<span class="sc">$</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
nontuftit    tuftit 
       50        50 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> training_tuftit_balanced <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>),</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">5</span>))</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

100 samples
 16 predictor
  2 classes: 'nontuftit', 'tuftit' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 90, 90, 90, 90, 90, 90, ... 
Resampling results across tuning parameters:

  cp    Accuracy  Kappa
  0.02  0.83      0.66 
  0.14  0.66      0.32 
  0.30  0.54      0.08 

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was cp = 0.02.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Check on the unbalanced testing data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> <span class="fu">predict</span>(fit, testing_tuftit),</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit        78      9
  tuftit           32      5
                                          
               Accuracy : 0.6694          
                 95% CI : (0.5792, 0.7512)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 1.0000000       
                                          
                  Kappa : 0.0386          
                                          
 Mcnemar's Test P-Value : 0.0005908       
                                          
            Sensitivity : 0.35714         
            Specificity : 0.70909         
         Pos Pred Value : 0.13514         
         Neg Pred Value : 0.89655         
             Prevalence : 0.11290         
         Detection Rate : 0.04032         
   Detection Prevalence : 0.29839         
      Balanced Accuracy : 0.53312         
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
<p><strong>Note</strong> that the accuracy is below the no information rate! However, kappa (improvement of accuracy over randomness) and sensitivity (the ability to identify tuftit) have increased.</p>
<p>There is a tradeoff between sensitivity and specificity (how many of the identified birds are really tuftits) The tradeoff can be controlled using the sample proportions. We can sample more tuftits to increase sensitivity at the cost of lower specificity (this effect cannot be seen in the data since the test set has only a few tuftits).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">strata</span>(training_tuftit, <span class="at">stratanames =</span> <span class="st">"species"</span>, <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), <span class="at">method =</span> <span class="st">"srswr"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>training_tuftit_balanced <span class="ot">&lt;-</span> training_tuftit <span class="sc">|&gt;</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(id<span class="sc">$</span>ID_unit)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(training_tuftit_balanced<span class="sc">$</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
nontuftit    tuftit 
       50       100 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> training_tuftit_balanced <span class="sc">|&gt;</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>),</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">5</span>))</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> <span class="fu">predict</span>(fit, testing_tuftit),</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit        58      9
  tuftit           52      5
                                          
               Accuracy : 0.5081          
                 95% CI : (0.4168, 0.5989)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : -0.0494         
                                          
 Mcnemar's Test P-Value : 7.551e-08       
                                          
            Sensitivity : 0.35714         
            Specificity : 0.52727         
         Pos Pred Value : 0.08772         
         Neg Pred Value : 0.86567         
             Prevalence : 0.11290         
         Detection Rate : 0.04032         
   Detection Prevalence : 0.45968         
      Balanced Accuracy : 0.44221         
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
</section>
<section id="option-3-build-a-larger-tree-and-use-predicted-probabilities" class="level3">
<h3 class="anchored" data-anchor-id="option-3-build-a-larger-tree-and-use-predicted-probabilities"><strong>Option 3: Build A Larger Tree and use Predicted Probabilities</strong></h3>
<p>Increase complexity and require less data for splitting a node. Here I also use AUC (area under the ROC) as the tuning metric. You need to specify the two class summary function. Note that the tree still trying to improve accuracy on the data and not AUC! I also enable class probabilities since I want to predict probabilities later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> training_tuftit <span class="sc">|&gt;</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">tuneLength =</span> <span class="dv">10</span>,</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">classProbs =</span> <span class="cn">TRUE</span>,  <span class="do">## necessary for predict with type="prob"</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">summaryFunction=</span>twoClassSummary),  <span class="do">## necessary for ROC</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">metric =</span> <span class="st">"ROC"</span>,</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

126 samples
 16 predictor
  2 classes: 'nontuftit', 'tuftit' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 114, 113, 113, 113, 113, 114, ... 
Resampling results:

  ROC       Sens      Spec
  0.682197  0.955303  0.2 

Tuning parameter 'cp' was held constant at a value of 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> <span class="fu">predict</span>(fit, testing_tuftit),</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit        99     11
  tuftit           11      3
                                          
               Accuracy : 0.8226          
                 95% CI : (0.7438, 0.8853)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 0.9885          
                                          
                  Kappa : 0.1143          
                                          
 Mcnemar's Test P-Value : 1.0000          
                                          
            Sensitivity : 0.21429         
            Specificity : 0.90000         
         Pos Pred Value : 0.21429         
         Neg Pred Value : 0.90000         
             Prevalence : 0.11290         
         Detection Rate : 0.02419         
   Detection Prevalence : 0.11290         
      Balanced Accuracy : 0.55714         
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
<p><strong>Note:</strong> Accuracy is high, but it is close or below to the no-information rate!</p>
<section id="create-a-biased-classifier" class="level4">
<h4 class="anchored" data-anchor-id="create-a-biased-classifier">Create A Biased Classifier</h4>
<p>We can create a classifier which will detect more tuftits at the expense of misclassifying non-tuftit. This is equivalent to increasing the cost of misclassifying a tuftit as a non-tuftit. The usual rule is to predict in each node the majority class from the test data in the node. For a binary classification problem that means a probability of &gt;50%. In the following, we reduce this threshold to 1% or more. This means that if the new observation ends up in a leaf node with 1% or more tuftits from training then the observation will be classified as a tuftit. The data set is small and this works better with more data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, testing_tuftit, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              nontuftit     tuftit
OBS1063879729 0.0000000 1.00000000
OBS1057240025 0.9000000 0.10000000
OBS1093405579 0.9000000 0.10000000
OBS1029432885 0.9622642 0.03773585
OBS1045430740 0.9622642 0.03773585
OBS1032311687 0.9622642 0.03773585</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(prob[,<span class="st">"tuftit"</span>]<span class="sc">&gt;=</span><span class="fl">0.01</span>, <span class="st">"tuftit"</span>, <span class="st">"nontuftit"</span>))</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit        13      2
  tuftit           97     12
                                          
               Accuracy : 0.2016          
                 95% CI : (0.1349, 0.2831)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : -0.0062         
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.85714         
            Specificity : 0.11818         
         Pos Pred Value : 0.11009         
         Neg Pred Value : 0.86667         
             Prevalence : 0.11290         
         Detection Rate : 0.09677         
   Detection Prevalence : 0.87903         
      Balanced Accuracy : 0.48766         
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
<p><strong>Note</strong> that accuracy goes down and is below the no information rate. However, both measures are based on the idea that all errors have the same cost. What is important is that we are now able to find more tuftits.</p>
</section>
<section id="plot-the-roc-curve" class="level4">
<h4 class="anchored" data-anchor-id="plot-the-roc-curve">Plot the ROC Curve</h4>
<p>Since we have a binary classification problem and a classifier that predicts a probability for an observation to be a tuftit, we can also use a <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">receiver operating characteristic (ROC)</a> curve. For the ROC curve all different cutoff thresholds for the probability are used and then connected with a line. The area under the curve represents a single number for how well the classifier works (the closer to one, the better).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pROC"</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">roc</span>(testing_tuftit<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"tuftit"</span>, prob[,<span class="st">"tuftit"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
roc.default(response = testing_tuftit$species == "tuftit", predictor = prob[,     "tuftit"])

Data: prob[, "tuftit"] in 110 controls (testing_tuftit$species == "tuftit" FALSE) &lt; 14 cases (testing_tuftit$species == "tuftit" TRUE).
Area under the curve: 0.6019</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(r) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">1</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="option-4-use-a-cost-sensitive-classifier" class="level3">
<h3 class="anchored" data-anchor-id="option-4-use-a-cost-sensitive-classifier"><strong>Option 4: Use a Cost-Sensitive Classifier</strong></h3>
<p>The implementation of CART in <code>rpart</code> can use a cost matrix for making splitting decisions (as parameter <code>loss</code>). The matrix has the form</p>
<p>TP FP FN TN</p>
<p>TP and TN have to be 0. We make FN very expensive (100).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>cost <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,   <span class="dv">1</span>,</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100</span>, <span class="dv">0</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    0    1
[2,]  100    0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> training_tuftit <span class="sc">|&gt;</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(species <span class="sc">~</span> .,</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> _,</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">loss =</span> cost),</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

126 samples
 16 predictor
  2 classes: 'nontuftit', 'tuftit' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 113, 113, 114, 114, 113, 114, ... 
Resampling results:

  Accuracy  Kappa     
  0.474359  0.04538828

Tuning parameter 'cp' was held constant at a value of 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit<span class="sc">$</span>finalModel, <span class="at">extra =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw-03_part1_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> <span class="fu">predict</span>(fit, testing_tuftit),</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ref =</span> testing_tuftit<span class="sc">$</span>species, <span class="at">positive =</span> <span class="st">"tuftit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  nontuftit tuftit
  nontuftit        45      3
  tuftit           65     11
                                          
               Accuracy : 0.4516          
                 95% CI : (0.3621, 0.5435)
    No Information Rate : 0.8871          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0664          
                                          
 Mcnemar's Test P-Value : 1.389e-13       
                                          
            Sensitivity : 0.78571         
            Specificity : 0.40909         
         Pos Pred Value : 0.14474         
         Neg Pred Value : 0.93750         
             Prevalence : 0.11290         
         Detection Rate : 0.08871         
   Detection Prevalence : 0.61290         
      Balanced Accuracy : 0.59740         
                                          
       'Positive' Class : tuftit          
                                          </code></pre>
</div>
</div>
<p>The high cost for false negatives results in a classifier that does not miss any tuftit.</p>
<p>Using the basic concepts and techniques on the bird data shows that the 16 true/false variables about environmental factors in connection with observations of bird species do not serve as good classifiers for identification purposes. Most models had low accuracy and p-values that were not significant. These results were the same when working with class imbalances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the bird_df to data folder so that we can use it for part 2</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(bird_df, <span class="st">"data/bird.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can we predict the presence or absence of a specific bird species based on habitat type, surrounding environment (like presence of squirrels, cats, humans, etc.), and feeding habits in a given location?</p>
<p>I would that the answer is no. However, I limited the data I was considering and the species. I may have gotten different results if I had chosen other bird species or logical(true /false) variable. But for these 5 species and these 16 variable about the habitat and surrounding area the answer is no.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>